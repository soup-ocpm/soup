<!--The progress bar-->
<app-s-progressbar *ngIf="isCreatingDataset"></app-s-progressbar>

<!--Master Layout-->
<div
  class="master"
  *ngIf="!this.isLoadingDatasets && !this.isCreatingDataset">
  <!--Overlay sidebar open-->
  <div
    class="overlay"
    *ngIf="this.isOpenSidebar"></div>

  <!--All Dataset-->
  <div *ngIf="this.haveDatasets && !this.isShowContainers">
    <div class="header">
      <div style="display: flex; justify-content: space-between; align-items: center">
        <h4>All Dataset</h4>
        <i
          class="bi bi-arrow-clockwise"
          style="font-size: 24px; cursor: pointer; color: var(--secondary-color)"
          onmouseover="this.style.color='var(--primary-color)'"
          onmouseout="this.style.color='var(--secondary-color)'"
          (click)="this.reloadDatasets()"></i>
      </div>
      <app-s-divider></app-s-divider>
    </div>

    <div class="search-dataset">
      <input
        class="form-control form-control-sm"
        style="margin-top: 10px"
        type="text"
        placeholder="Search dataset"
        [(ngModel)]="searchTerm" />
    </div>

    <div class="dataset-grid">
      <ng-container *ngFor="let item of this.filteredDatasets()">
        <app-dataset-tile
          [dataset]="item"
          (selectedDataset)="this.onSelectedDataset($event)"
          (manageDataset)="this.onManageDataset($event)"
          (deleteDataset)="this.onDeleteDataset($event)"></app-dataset-tile>
      </ng-container>
    </div>
  </div>

  <!--No dataset-->
  <div
    class="no-dataset"
    *ngIf="!this.haveDatasets && !this.isShowContainers">
    <img src="/images/graph2.svg" />
    <p>
      You do not have any Datasets
      <br />
      within your Memgraph database
    </p>
    <app-s-button
      [text]="'New Dataset'"
      (buttonClick)="this.newDataset()"></app-s-button>
  </div>

  <!-- Sidebar -->
  <div
    class="sidebar"
    [ngClass]="{ show: isOpenSidebar }">
    <div *ngIf="this.currentDataset != null">
      <div class="sidebar-header">
        <h4>{{ this.currentDataset!.name }} Dataset</h4>
        <i
          class="bi bi-x-lg"
          (click)="this.handleSidebar()"></i>
      </div>

      <form>
        <div
          class="mb-2"
          style="margin-top: 20px">
          <label
            for="datasetName"
            class="form-label">
            Name
          </label>
          <input
            disabled="true   "
            class="form-control form-control-sm"
            id="datasetName"
            type="text"
            name="datasetName"
            [(ngModel)]="currentDataset!.name"
            (ngModelChange)="this.checkForModelChange()" />
        </div>

        <div
          class="mb-2"
          style="margin-top: 20px">
          <label
            for="datasetDescription"
            class="form-label">
            Description
          </label>
          <textarea
            class="form-control"
            id="datasetDescription"
            style="max-height: 150px"
            name="datasetDescription"
            rows="3"
            [(ngModel)]="currentDataset!.description"
            (ngModelChange)="this.checkForModelChange()"></textarea>
        </div>
      </form>

      <div
        *ngIf="this.currentDataset.svg != null"
        style="margin-top: 20px">
        <p class="form-label">Graph preview</p>
        <div *ngIf="checkIfSvgIsValid(currentDataset?.svg)">
          <div [innerHTML]="currentDataset!.svg"></div>
        </div>
      </div>

      <!--Column sidebar-->
      <div style="margin-top: 30px">
        <p class="form-label">CSV Columns</p>
      </div>

      <div style="display: flex">
        <p
          style="color: var(--primary-color); text-decoration: underline; cursor: pointer"
          (click)="this.handleColumnSidebar()">
          View
        </p>
        <p style="margin-left: 3px">the csv and filtered columns for this Dataset</p>
      </div>

      <!--Buttons-->
      <div class="master-footer">
        <app-s-button
          *ngIf="this.modelChange && !this.isLoadingUpdate"
          [text]="'Save'"
          (buttonClick)="this.onSaveUpdate()"></app-s-button>

        <app-s-spinner-one *ngIf="this.isLoadingUpdate"></app-s-spinner-one>

        <app-s-button
          *ngIf="this.modelChange && !this.isLoadingUpdate"
          [disabled]="this.isLoadingUpdate"
          [text]="'Restore'"
          [color]="'#6c757d'"
          (buttonClick)="this.restoreModel()"></app-s-button>

        <app-s-button
          [text]="'Delete'"
          *ngIf="!this.isLoadingUpdate"
          [disabled]="this.isLoadingUpdate && !this.isLoadingUpdate"
          [color]="'#FF0000'"
          (buttonClick)="this.openModalDelete()"></app-s-button>
      </div>
    </div>
  </div>

  <!--Column Sidebar-->
  <div
    class="sidebar"
    [ngClass]="{ show: this.isOpenColumnsSidebar }">
    <div *ngIf="this.currentDataset != null">
      <div class="sidebar-header">
        <h4>CSV Columns</h4>
        <i
          class="bi bi-x-lg"
          (click)="this.handleColumnSidebar()"></i>
      </div>

      <!--Columns-->
      <div class="dataset-columns">
        <div class="value-columns">
          <p style="font-weight: bold">Dataset csv columns</p>
          @for (column of this.currentDataset!.allColumns; track $index) {
            <div class="column">
              {{ column }}
            </div>
          }
        </div>
        <div class="filtered-columns">
          <p style="font-weight: bold">Filtered columns</p>
          @for (column of this.currentDataset!.filteredColumns; track $index) {
            <div class="column">
              {{ column }}
            </div>
          }
        </div>
      </div>
    </div>
  </div>
</div>

<!--Loading status-->
<div
  class="loading-datasets"
  *ngIf="this.isLoadingDatasets">
  <app-s-spinner-one></app-s-spinner-one>
  <h4>Loading datasets...</h4>
</div>

<!--Loading content-->
<div *ngIf="this.isCreatingDataset">
  <div class="process-div">
    <h3>
      Building the EKG
      <br />
      This operation may take a few minutes...
    </h3>
  </div>
</div>
