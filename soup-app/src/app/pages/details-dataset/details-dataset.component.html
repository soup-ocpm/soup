<!--The progress bar-->
<sp-progressbar *ngIf="this.isLoading"></sp-progressbar>

<!--Master content-->
<div class="master">
  <div *ngIf="!this.isLoading">
    <!--Data-->
    <div class="dataset-content">
      <div class="dataset-name">
        <h4>{{ this.currentDataset?.name }} dataset</h4>
      </div>

      <div class="content">
        <div class="info">
          <div class="info-title">
            <h5>Data information</h5>
          </div>
          <p>
            Generated
            <span class="bold">{{ this.currentDataset?.eventNodes }}</span>
            event nodes
          </p>
          <p>
            Generated
            <span class="bold">{{ this.currentDataset?.entityNodes }}</span>
            entity nodes
          </p>
          <p>
            Generated
            <span class="bold">{{ this.currentDataset?.corrRel }}</span>
            :CORR links
          </p>
          <p>
            Generated
            <span class="bold">{{ this.currentDataset?.dfRel }}</span>
            :DF links
          </p>
        </div>

        <div class="graphs">
          <div class="master-pie">
            <div style="display: block">
              <canvas #dataPieChart></canvas>
            </div>
          </div>
        </div>
      </div>

      <!--Process info-->
      <div
        class="content"
        style="margin-top: 100px">
        <div class="info">
          <div class="info-title">
            <h5>Process Execution info</h5>
          </div>
          <p>
            Total execution time:
            <span class="bold-two">{{ this.currentDataset?.processInfo?.durationNormalExecution }}</span>
            seconds
          </p>
          <p>
            Event nodes execution time:
            <span class="bold-two">{{ this.currentDataset?.processInfo?.durationEventExecution }}</span>
            seconds
          </p>
          <p>
            Entity nodes execution time
            <span class="bold-two">{{ this.currentDataset?.processInfo?.durationEntityExecution }}</span>
            seconds
          </p>
          <p>
            :CORR links execution time:
            <span class="bold-two">{{ this.currentDataset?.processInfo?.durationCorrExecution }}</span>
            seconds
          </p>
          <p>
            :DF links execution time:
            <span class="bold-two">{{ this.currentDataset?.processInfo?.durationDfExecution }}</span>
            seconds
          </p>
        </div>

        <div class="graphs">
          <!--Pie chart-->
          <div class="master-pie">
            <div style="display: block">
              <canvas #processPieChart></canvas>
            </div>
          </div>
        </div>
      </div>

      <!--Aggregate Charts-->
      <div *ngIf="this.currentDataset!.classNodes > 0">
        <!--Aggregate data-->
        <div
          class="content"
          style="margin-top: 100px">
          <div class="info">
            <div class="info-title">
              <h5>Aggregate Graph information</h5>
            </div>
            <p>
              Generated
              <span class="bold">{{ this.currentDataset?.classNodes }}</span>
              class nodes
            </p>
            <p>
              Generated
              <span class="bold">{{ this.currentDataset?.obsRel }}</span>
              :OBS links
            </p>
            <p>
              Generated
              <span class="bold">{{ this.currentDataset?.dfcRel }}</span>
              :DFC links
            </p>
          </div>

          <div class="graphs">
            <div class="master-pie">
              <div style="display: block">
                <canvas #aggregateDataPieChart></canvas>
              </div>
            </div>
          </div>
        </div>

        <!--Aggregate process info-->
        <div
          class="content"
          style="margin-top: 100px">
          <div class="info">
            <div class="info-title">
              <h5>Aggregate Graph process Eexecution info</h5>
            </div>
            <p>
              Total execution time:
              <span class="bold-two">{{ this.currentDataset?.processInfo?.durationClassExecution }}</span>
              seconds
            </p>
            <p>
              Class nodes execution time:
              <span class="bold-two">{{ this.currentDataset?.processInfo?.durationClassNodeExecution }}</span>
              seconds
            </p>
            <p>
              :OBS links execution time:
              <span class="bold-two">{{ this.currentDataset?.processInfo?.durationObsExecution }}</span>
              seconds
            </p>
            <p>
              :DF_C links execution time:
              <span class="bold-two">{{ this.currentDataset?.processInfo?.durationDfCExecution }}</span>
              seconds
            </p>
          </div>

          <div class="graphs">
            <!--Pie chart-->
            <div class="master-pie">
              <div style="display: block">
                <canvas #aggregateProcessPieChart></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!--Loading content-->
  <div *ngIf="isLoading">
    <div class="process-div">
      <h3>
        Building the Class EKG
        <br />
        This operation may take a few minutes...
      </h3>
    </div>
  </div>
</div>

<!--Overlay sidebar open-->
<div
  class="overlay"
  *ngIf="this.sidebarService.isSidebarOpen('new-analysis')"></div>

<!--List of the sidebar-->
<s-sidebar
  *ngFor="let sidebarId of this.sidebarIds"
  [sidebarId]="sidebarId"></s-sidebar>

<!-- Master Sidebar template-->
<ng-template #masterSidebarTemplate>
  <p class="sidebar-intro">A list of operations available for this section</p>

  <!-- Operations Section -->
  <div class="operation-container">
    <app-side-operation
      *ngFor="let operation of this.operations"
      [title]="operation.title"
      [description]="operation.description"
      [icon]="operation.icon"
      [action]="operation.action"
      (operationSelected)="this.onOperationSelected(operation)"></app-side-operation>
  </div>
</ng-template>

<!--Graph visualization Sidebar template-->
<ng-template #graphVisualizationSidebarTemplate>
  <p style="margin-top: 15px">This operation allows to view the Graph</p>

  <sp-divider></sp-divider>

  <li class="list-group-item">
    <span style="margin-top: 5px">Standard Graph</span>

    <div class="group">
      <i
        class="bi bi-arrow-right-square-fill"
        style="color: green; cursor: pointer"
        (click)="this.goToGraphVisualization(true)"></i>
    </div>
  </li>

  <li class="list-group-item">
    <span style="margin-top: 5px">Aggregate Graph</span>

    <div class="group">
      <i
        class="bi bi-arrow-right-square-fill"
        style="color: green; cursor: pointer"
        (click)="this.goToGraphVisualization(false)"></i>
    </div>
  </li>
</ng-template>

<!--Aggregate Sidebar template-->
<ng-template #aggregateSidebarTemplate>
  <p style="margin-top: 15px">
    This operation allows to group nodes into classes. The default aggregation considers the Activity property. Moreover, here you can
    select the desired entities that will be also taken into account when creating Class nodes
  </p>

  <sp-divider></sp-divider>

  <li
    *ngFor="let entity of this.entityList"
    class="list-group-item">
    <span style="margin-top: 5px">{{ entity.name }}</span>

    <div class="group">
      <mat-icon
        *ngIf="entity.numberOfNanNodes > 0"
        [matTooltip]="getEntityWarningLabel(entity)">
        warning
      </mat-icon>
      <mat-slide-toggle
        style="margin-top: 3px"
        [(ngModel)]="entity.isSelected"
        (change)="selectionEntity(entity)"
        color="primary"></mat-slide-toggle>
    </div>
  </li>

  <div style="margin-top: 13px"></div>
  <sp-divider></sp-divider>

  <div *ngIf="this.currentDataset!.classNodes > 0">
    <p style="color: #ff0000; margin-top: 10px">Warning</p>
    <p>
      Aggregate class graph is already present inside the Memgraph Database. This operation will remove the present graph to make new
      aggregation
    </p>
  </div>
</ng-template>

<!--New analysis template-->
<ng-template #newAnalysisSidebarTemplate>
  <p>From here you can add filters and create a new analysis</p>
  <div class="master-filters">
    <div
      *ngFor="let tile of this.tiles"
      class="filter-tile">
      <strong>{{ tile.type }}</strong>
      <p>{{ tile.details }}</p>
    </div>
    <button
      class="plus-button"
      (click)="this.addNewAnalysisTile()">
      <i class="bi bi-plus-lg"></i>
    </button>
  </div>
</ng-template>

<!--History analysis template-->
<ng-template #historyanalysis></ng-template>
