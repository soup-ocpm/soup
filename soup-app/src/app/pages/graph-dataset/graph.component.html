<div class="master">
  <!--Graph visualization-->
  <div
    class="master-graph"
    [ngClass]="{ small: this.isOpenMenuSidebar, 'small-two': this.isOpenSearchSidebar }">
    <div id="myGraphContainer">
      <svg #graphSvg></svg>
    </div>
  </div>

  <!--Right Action buttons-->
  <div class="right-actions">
    <i
      matTooltip="Menu"
      class="bi bi-card-list"
      style="margin-right: 7px"
      (click)="this.handleMenuOperations()"></i>
    <i
      matTooltip="Search"
      class="bi bi-search"
      style="margin-top: 10px; margin-right: 7px"
      (click)="this.handleSearchData()"></i>
  </div>

  <!--Left Action buttons-->
  <div
    class="left-actions"
    *ngIf="!this.isOpenMenuSidebar && !this.isOpenSearchSidebar">
    <i
      matTooltip="Leave"
      class="bi bi-arrow-left-square"
      (click)="this.leavePage()"></i>
  </div>

  <!--Menu Sidebar-->
  <div
    class="sidebar"
    [ngClass]="{ show: this.isOpenMenuSidebar }">
    <div class="sidebar-header">
      <h4>Manage Dataset</h4>
      <i
        class="bi bi-x-lg"
        (click)="this.isOpenMenuSidebar = false"></i>
    </div>
    <p>A list of operations available for this section</p>

    <div style="margin-top: 35px"></div>
    <div class="double-flex">
      <h5
        class="underline-h"
        (click)="this.handleGraphSidebarManager()">
        Manage graph visualization
      </h5>
    </div>
    <p>Change the view of your graph</p>

    <!--Export JSON-->
    <div style="margin-top: 35px"></div>
    <div class="double-flex">
      <h5
        class="underline-h"
        (click)="this.handleJSONSidebar()">
        Export JSON
      </h5>
    </div>
    <p>Export and save the full JSON of the nodes and edges</p>

    <!--Export SVG-->
    <div style="margin-top: 35px"></div>
    <div class="double-flex">
      <h5 (click)="this.handleGraphSidebarManager()">Export SVG</h5>
    </div>
    <p>Export and save the SVG of the graph</p>

    <sp-btn
      [text]="'Download'"
      [height]="'27px'"
      (buttonClick)="this.exportSvg()"></sp-btn>

    <!--Delete dataset-->
    <div style="margin-top: 35px"></div>
    <div class="double-flex">
      <h5>Delete Dataset</h5>
    </div>
    <p>This operation is not reversible</p>
    <sp-btn
      [text]="'Delete'"
      [height]="'27px'"
      [color]="'#FF0000'"
      (buttonClick)="this.handleDeleteGraph()"></sp-btn>
  </div>

  <!--Search Sidebar-->
  <div
    class="sidebar"
    [ngClass]="{ show: this.isOpenSearchSidebar }"
    [ngStyle]="{ width: '600px' }">
    <div class="sidebar-header">
      <h4>Search Data</h4>
      <i
        class="bi bi-x-lg"
        (click)="this.closeSearchSidebar()"></i>
    </div>
    <p>Search node or links inside your graph</p>

    <!--Input-->
    <div class="search-dataset">
      <input
        class="form-control form-control-sm"
        style="margin-top: 10px"
        type="text"
        placeholder="Receive Order..."
        [(ngModel)]="searchTerm"
        (input)="this.searchData()" />
    </div>

    <div style="height: 20px"></div>
    <sp-divider></sp-divider>

    <!--Tabber-->
    <mat-tab-group
      #tabber
      (selectedTabChange)="this.onTabChange($event)">
      <!--Node tab-->
      <mat-tab
        label="Nodes"
        class="tabber">
        <div
          class="master-search"
          (scroll)="onScrollNodes()"
          style="margin-top: 15px"
          #scrollNodeContainer>
          <div
            class="search-term"
            *ngFor="let item of displayedNodes">
            <div class="item-details">
              <h5>{{ item['ActivityName'] }}</h5>
              <p>
                <strong>Event ID:</strong>
                {{ item['EventID'] }}
              </p>
              <p>
                <strong>Type:</strong>
                {{ item['Type'] }}
              </p>
            </div>
            <div class="icon-section">
              <i
                class="bi bi-arrow-right-circle"
                (click)="selectNodeSearched(item)"></i>
            </div>
          </div>

          <!-- Loading -->
          <div
            class="loading-indicator"
            *ngIf="isLoading">
            <p>Loading more data...</p>
          </div>
        </div>
      </mat-tab>

      <!--Edges tab-->
      <mat-tab
        label="Links"
        class="tabber">
        <div
          class="master-search"
          (scroll)="onScrollEdges()"
          style="margin-top: 15px"
          #scrollEdgesContainer>
          <div
            class="search-term"
            *ngFor="let item of displayedEdges"
            (click)="this.selectEdgeSearched(item)">
            <div class="item-details">
              <h5>{{ item['label'] }}</h5>
              <p>
                <strong>From node:</strong>
                {{ item.source.id }}
              </p>
              <p>
                <strong>To node:</strong>
                {{ item.target.id }}
              </p>
            </div>
            <div class="icon-section">
              <i class="bi bi-arrow-right-circle"></i>
            </div>
          </div>

          <!-- Loading-->
          <div
            class="loading-indicator"
            *ngIf="isLoading">
            <p>Loading more data...</p>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>

  <!--Json Sidebar-->
  <div
    class="sidebar"
    [ngClass]="{ show: this.isOpenJSONSidebar }">
    <div class="sidebar-header">
      <h4>Export JSON</h4>
      <i
        class="bi bi-x-lg"
        (click)="this.handleJSONSidebar()"></i>
    </div>
    <p style="margin-top: 15px">This operation allows to download specific JSON of your Dataset.</p>

    <sp-divider></sp-divider>

    <li
      *ngFor="let object of this.jsonList"
      class="list-group-item">
      <span style="margin-top: 5px">{{ object.name }}</span>

      <div class="group">
        <mat-slide-toggle
          style="margin-top: 3px"
          [(ngModel)]="object.isSelected"
          (change)="selectionJson(object)"
          color="primary"></mat-slide-toggle>
      </div>
    </li>

    <div style="margin-top: 13px"></div>
    <sp-divider></sp-divider>

    <div class="master-footer">
      <sp-btn
        *ngIf="this.selectedJson.length > 0 && !this.isLoadingJsonDownload"
        [text]="'Download'"
        (buttonClick)="this.downloadJsonSelected()"></sp-btn>
      <sp-spinner *ngIf="this.isLoadingJsonDownload"></sp-spinner>
      <sp-btn
        *ngIf="this.selectedJson.length > 0"
        [text]="'Restore'"
        [color]="'#6c757d'"
        (buttonClick)="this.resetJsonSelection()"></sp-btn>
    </div>
  </div>

  <!--Manage graph Sidebar-->
  <div
    class="sidebar"
    [ngClass]="{ show: this.isShowManageGraphSidebar }">
    <div class="sidebar-header">
      <h4>Manage graph</h4>
      <i
        class="bi bi-x-lg"
        (click)="this.isShowManageGraphSidebar = false"></i>
    </div>
    <p>A list of operations available for this section</p>

    <div style="margin-top: 35px">
      <!--Node view-->
      <div style="margin-top: 35px"></div>
      <div class="double-flex">
        <h5>Nodes</h5>
        <mat-icon [matTooltip]="'The size of the circle does not correspond to node weight'">warning</mat-icon>
      </div>
      <p>Change the view of your nodes</p>
      <div style="margin-top: 15px"></div>
      <mat-radio-group
        aria-labelledby="example-radio-group-label"
        class="example-radio-group"
        [(ngModel)]="nodeViewType"
        (ngModelChange)="this.onChangeNodeView($event)">
        @for (type of allNodesViewType; track type) {
          <mat-radio-button
            class="example-radio-button"
            color="primary"
            [value]="type">
            {{ type }}
          </mat-radio-button>
        }
      </mat-radio-group>

      <!--Edges view-->
      <div style="margin-top: 35px"></div>
      <div class="double-flex">
        <h5>Edges</h5>
      </div>

      <p>Select the relationships you want to see</p>

      <div *ngFor="let rel of this.allRelationships">
        <mat-checkbox
          color="primary"
          [ngModel]="rel.selected"
          (ngModelChange)="this.onChangeRelationshipsView(rel, $event)">
          {{ rel.name }}
        </mat-checkbox>
      </div>
    </div>
  </div>
</div>
