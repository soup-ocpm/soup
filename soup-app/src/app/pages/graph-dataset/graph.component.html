<div class="master">
  <!--Graph visualization-->
  <div
    class="master-graph"
    [ngClass]="{
      small: this.sidebarService.isSidebarOpen('master-sidebar'),
      'small-two': this.sidebarService.isSidebarOpen('search-sidebar')
    }">
    <div id="myGraphContainer">
      <svg #graphSvg></svg>
    </div>
  </div>

  <!--Right Action buttons-->
  <div class="right-actions">
    <i
      matTooltip="Menu"
      class="bi bi-card-list"
      style="margin-right: 7px"
      (click)="this.openMasterSidebar()"></i>
    <i
      matTooltip="Search"
      class="bi bi-search"
      style="margin-top: 10px; margin-right: 7px"
      (click)="this.openSearchSidebar()"></i>
  </div>

  <!--Left Action buttons-->
  <div
    class="left-actions"
    *ngIf="!this.sidebarService.isSidebarOpen('master-sidebar') && !this.sidebarService.isSidebarOpen('search-sidebar')">
    <i
      matTooltip="Leave"
      class="bi bi-arrow-left-square"
      (click)="this.leavePage()"></i>
  </div>

  <!--Card for selected node-->
  <div
    *ngIf="this.isShowCardProperties"
    class="node-properties-card">
    <h4>Node Properties</h4>
    <div
      *ngFor="let property of this.propertiesSelectedNode"
      class="property-item">
      <strong>{{ property[0] }}:</strong>
      <span>{{ property[1] || 'N/A' }}</span>
    </div>
    <button
      class="close-btn"
      (click)="this.closeNodeSearched()">
      Close
    </button>
  </div>

  <!--List of the sidebar-->
  <s-sidebar
    *ngFor="let sidebarId of this.sidebarIds"
    [sidebarId]="sidebarId"></s-sidebar>

  <!--Menu Sidebar-->
  <ng-template #masterSidebarTemplate>
    <p>A list of operations available for this section</p>

    <!-- Operations Section -->
    <div class="operation-container">
      <app-side-operation
        *ngFor="let operation of this.operations"
        [title]="operation.title"
        [description]="operation.description"
        [icon]="operation.icon"
        [action]="operation.action"
        (operationSelected)="this.onOperationSelected(operation)"></app-side-operation>
    </div>
  </ng-template>

  <!--Search Sidebar-->
  <ng-template #searchSidebarTemplate>
    <p>Search node or links inside your graph</p>

    <!--Input-->
    <div class="search-dataset">
      <input
        class="form-control form-control-sm"
        style="margin-top: 10px"
        type="text"
        placeholder="Receive Order..."
        [(ngModel)]="searchTerm"
        (input)="this.searchData()" />
    </div>

    <div style="height: 20px"></div>
    <sp-divider></sp-divider>

    <!--Tabber-->
    <mat-tab-group
      #tabber
      (selectedTabChange)="this.onTabChange($event)">
      <!--Node tab-->
      <mat-tab
        label="Nodes"
        class="tabber">
        <div
          class="master-search"
          (scroll)="onScrollNodes()"
          style="margin-top: 15px"
          #scrollNodeContainer>
          <div
            class="search-term"
            *ngFor="let item of displayedNodes">
            <div class="item-details">
              <p>
                <strong>Activity:</strong>
                <span style="color: var(--primary-color)">{{ item['ActivityName'] }}</span>
              </p>
              <p>
                <strong>Event id:</strong>
                {{ item['Event_Id'] }}
              </p>
              <p *ngIf="this.isViewStandardGraph">
                <strong>Timestamp:</strong>
                {{ item['Timestamp'] }}
              </p>
            </div>
            <div class="icon-section">
              <i
                class="bi bi-arrow-right-circle"
                (click)="this.selectNodeSearched(item)"></i>
            </div>
          </div>

          <!-- Loading -->
          <div
            class="loading-indicator"
            *ngIf="isLoading">
            <p>Loading more data...</p>
          </div>
        </div>
      </mat-tab>

      <!--Edges tab-->
      <mat-tab
        label="Links"
        class="tabber">
        <div
          class="master-search"
          (scroll)="onScrollEdges()"
          style="margin-top: 15px"
          #scrollEdgesContainer>
          <div
            class="search-term"
            *ngFor="let item of displayedEdges"
            (click)="this.selectEdgeSearched(item)">
            <div class="item-details">
              <h5 style="color: var(--primary-color)">{{ item['label'] }}</h5>
              <p>
                <strong>From:</strong>
                {{ getNodeName(item.source.id) }} [{{ item.source.id }}]
              </p>
              <p>
                <strong>To:</strong>
                {{ getNodeName(item.target.id) }} [{{ item.target.id }}]
              </p>
            </div>
          </div>

          <!-- Loading-->
          <div
            class="loading-indicator"
            *ngIf="isLoading">
            <p>Loading more data...</p>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </ng-template>

  <!--Json Sidebar-->
  <ng-template #jsonSidebarTemplate>
    <p style="margin-top: 15px">This operation allows to download specific JSON of your Dataset.</p>

    <sp-divider></sp-divider>

    <li
      *ngFor="let object of this.jsonList"
      class="list-group-item">
      <span style="margin-top: 5px">{{ object.name }}</span>

      <div class="group">
        <mat-slide-toggle
          style="margin-top: 3px"
          [(ngModel)]="object.isSelected"
          (change)="this.selectionJson(object)"
          color="primary"></mat-slide-toggle>
      </div>
    </li>
  </ng-template>

  <!--Manage graph Sidebar-->
  <ng-template #manageGraphSidebarTemplate>
    <p>A list of operations available for this section</p>

    <div style="margin-top: 35px">
      <!--Node view-->
      <div style="margin-top: 35px"></div>
      <div class="double-flex">
        <h5>Nodes</h5>
        <mat-icon [matTooltip]="'The size of the circle does not correspond to node weight'">warning</mat-icon>
      </div>
      <p>Change the view of your nodes</p>
      <div style="margin-top: 15px"></div>
      <mat-radio-group
        aria-labelledby="example-radio-group-label"
        class="example-radio-group"
        [(ngModel)]="nodeViewType"
        (ngModelChange)="this.onChangeNodeView($event)">
        @for (type of allNodesViewType; track type) {
          <mat-radio-button
            class="example-radio-button"
            color="primary"
            [value]="type">
            {{ type }}
          </mat-radio-button>
        }
      </mat-radio-group>

      <!--Edges view-->
      <div style="margin-top: 35px"></div>
      <div class="double-flex">
        <h5>Edges</h5>
      </div>

      <p>Select the relationships you want to see</p>

      <div *ngFor="let rel of this.allRelationships">
        <mat-checkbox
          color="primary"
          [ngModel]="rel.selected"
          (ngModelChange)="this.onChangeRelationshipsView(rel, $event)">
          {{ rel.name }}
        </mat-checkbox>
      </div>
    </div>
  </ng-template>
</div>
